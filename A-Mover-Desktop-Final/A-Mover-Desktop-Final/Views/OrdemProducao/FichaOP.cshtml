@model A_Mover_Desktop_Final.Models.OrdemProducao

@{
    ViewData["Title"] = "Ficha da Ordem de Produção";
    var apenasVisualizar = Model.Estado == EstadoOrdemProducao.Concluida;
}

<form asp-action="GuardarChecklists" method="post">
    <input type="hidden" name="IDOrdemProducao" value="@Model.IDOrdemProducao" />

    <div class="card m-5 p-4">
        <h1 class="mb-4">Ficha da Ordem de Produção</h1>

        <!-- Cabeçalho -->
        <div class="row mb-4">
            <div class="col-md-6">
                <p><strong>Número da OP:</strong> @Model.NumeroOrdem</p>
                <p><strong>Estado:</strong> @Model.Estado</p>
                <p><strong>Data de Criação:</strong> @Model.DataCriacao.ToString("dd/MM/yyyy HH:mm")</p>
                @if (Model.DataConclusao.HasValue)
                {
                    <p><strong>Data de Conclusão:</strong> @Model.DataConclusao.Value.ToString("dd/MM/yyyy HH:mm")</p>
                }
            </div>
            <div class="col-md-6">
                <p><strong>Cliente:</strong> @Model.Encomenda.Cliente.Nome</p>
                <p><strong>Modelo:</strong> @Model.Encomenda.ModeloMota.Nome</p>
                <p><strong>País Destino:</strong> @Model.PaisDestino</p>
            </div>
        </div>

        <ul class="nav nav-tabs mb-4" id="tabSelector" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="motas-tab" data-bs-toggle="tab" data-bs-target="#motas" type="button" role="tab">Mota</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="checklists-tab" data-bs-toggle="tab" data-bs-target="#checklists" type="button" role="tab">Checklists de Controlo</button>
            </li>
        </ul>

        <div class="tab-content" id="tabContent">
            <div class="tab-pane fade" id="motas" role="tabpanel">
                @Html.Partial("_MotasPartial", Model)
            </div>
            <div class="tab-pane fade show active" id="checklists" role="tabpanel">
                @Html.Partial("_ChecklistsPartial", Model)
            </div>
        </div>

        <div class="mt-4 d-flex justify-content-between">
            <a asp-action="Index" class="btn btn-secondary">
                <i class="fas fa-arrow-left me-1"></i> Voltar
            </a>
            @if (!apenasVisualizar)
            {
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-save me-1"></i> Guardar Alterações
                </button>
                <a asp-action="Finalizar" asp-route-id="@Model.IDOrdemProducao" class="btn btn-primary ms-2">
                    <i class="fas fa-check-circle me-1"></i> Finalizar OP
                </a>
            }
        </div>
    </div>
</form>
